<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="/_/js/jquery.min.js"></script>
    <script src="/_/js/jquery-ui.min.js"></script>
    <script src="/_/js/bootstrap.min.js"></script>
    <link href="/_/css/bootstrap.min.css" rel="stylesheet">
    <link href="/_/css/jquery-ui.min.css" rel="stylesheet">
    <link href="/_/css/dirlist.css" rel="stylesheet">
    <title>Directory Listing: {{.dir}}</title>
  </head>
  <body>
    <div class="container">
      <table cellspacing=0 class="table">
        <h2>Directory List:  {{.dir}}</h2>
        <thead>
          <th>File</th>
          <th>Size</th>
          <th>Link</th>
          <th>Last Modified</th>
        </thead>
        {{range .files}}
        <tr>
          <td class="name">
            {{if ne .size "-"}}
            
            <a href="{{.href}}">{{.name}}</a>
            {{else}}
            <a href="{{.href}}">
              <span class="glyphicon glyphicon-folder-open"></span>
              <strong>{{.name}}</strong>
            </a>
            {{end}}
          </td>
          <td>{{ .size }}</td>
          <td>
            {{if ne .size "-"}}
            <a href="{{.href}}">
              <span class="glyphicon glyphicon-download-alt"></span>
            </a>
            &nbsp;
            <span class="glyphicon glyphicon-qrcode" data="http://{{.host}}/{{.path}}"></span>
            {{else}}
            {{if eq .name ".." }}
            <button data-toggle="modal" data-target="#upload-modal" class="btn btn-xs btn-success">
              <span class="glyphicon glyphicon-upload"></span> upload
            </button>
            {{end}}
            {{end}}
          </td>
          <td class="mtime">{{ .mtime }}</td>
        </tr>
        {{end}}
      </table>
      <script>
      $(function(){
      $("span.glyphicon-qrcode").click(function(){
      var url = $(this).attr("data");
      $("#img-qrcode").attr("src", "/_qr?text="+url);
      $("#dialog").dialog({
      dialogClass: "no-close", // FIXME: not working
      });
      })
      })
      // $(".btn-upload").
      $(function(){
        $("#btn-upload").click(function(){
          $("#form-upload").submit();
        });
      })
      </script>
      <div id="dialog" title="qrcode" style="display: none">
        <img id="img-qrcode" src=""/>
      </div>

      <!-- Modal -->
      <div class="modal fade" id="upload-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="myModalLabel">文件上传</h4>
            </div>
            <div class="modal-body">
              <form id="form-upload" role="form" method="post" enctype="multipart/form-data">
                  <input class="form-control" name="file" type="file" multiple="multiple" required>
              </form>
              ...
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <button id="btn-upload" type="button" class="btn btn-primary">上传</button>
            </div>
          </div>
        </div>
      </div>

      {{template "footer" .}}
    </div>
  </body>
</html>